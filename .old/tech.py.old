from gpiozero import LEDBoard, DistanceSensor, Button
from time import sleep
import subprocess, json

leds = LEDBoard(3,4)
sensorDist = DistanceSensor(echo=17, trigger=18)
button1 = Button(24)
button2 = Button(2)

# act_array[0] = Actuator("LED", 3, "blinkLEDslow", "blinkLED1slow")
# act_array[1] = Actuator("LED", 3, "blinkLEDfast", "blinkLED1fast")

# sens_array[0] = Sensor("Dist", 1718, "dist(X)")
# sens_array[1] = Sensor("Button", 24, "atHome", "-atHome")

# sensors = [ Button(24), Button(2),DistanceSensor(echo=17, trigger=18)]
# actuators = [Actuator(actuator_object=LEDBoard(3,4), fn=blinkLEDslow)]

def subproc():
    proc = subprocess.Popen(["/usr/bin/node","/home/yiannis/cyens/prudens-js/node/app.js", ], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    out, err = proc.communicate()
    json_out = json.loads(out)
    proc.terminate()
    return list(json_out["graph"].keys())
    
def blinkLEDslow(led_id):
    for i in range(len(leds)):
        leds[i].off()
    leds[led_id].on()
    sleep(1)
    leds[led_id].off()

def blinkLEDfast(led_id): 
    for i in range(len(leds)):
        leds[i].off()
    leds[led_id].on()
    sleep(0.2)
    leds[led_id].off()
    
def onLED(led_id):
    leds[led_id].on()
    
def sysStandby():
    for i in range(len(leds)):
        leds[i].off()
    
def getDist():
    return sensorDist.distance
